<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CREW CONTROL // REMOTE CONTROL</title>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #000a0e;
            --bg-secondary: #0a1419;
            --bg-tertiary: #0f1e27;
            --accent-cyan: #00fff7;
            --accent-green: #00ff7f;
            --accent-red: #ff004d;
            --accent-orange: #ff8b00;
            --accent-purple: #8a2be2;
            --text-primary: #ffffff;
            --text-secondary: #a0a9b8;
            --text-muted: #6c7683;
            --border-primary: rgba(0, 255, 247, 0.3);
            --border-secondary: rgba(160, 169, 184, 0.1);
            --glow-cyan: 0 0 20px rgba(0, 255, 247, 0.5);
            --glow-green: 0 0 20px rgba(0, 255, 127, 0.5);
            --glow-red: 0 0 20px rgba(255, 0, 77, 0.5);
            
            /* User Colors */
            --nacho: #14b8a6;
            --cena: #e5e7eb;
            --daniel: #eab308;
            --ace: #ef4444;
            --maze: #f97316;
            --brandon: #ec4899;
            --p: #3b82f6;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'JetBrains Mono', monospace;
            background: 
                radial-gradient(circle at 20% 20%, rgba(0, 255, 247, 0.03) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(0, 255, 127, 0.02) 0%, transparent 50%),
                linear-gradient(135deg, var(--bg-primary) 0%, var(--bg-secondary) 100%);
            min-height: 100vh;
            color: var(--text-primary);
            display: grid;
            grid-template-columns: 1fr 380px;
            gap: 0;
            overflow: hidden;
            position: relative;
        }
        
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                linear-gradient(0deg, transparent 0%, rgba(0, 255, 247, 0.02) 50%, transparent 100%),
                linear-gradient(90deg, transparent 0%, rgba(0, 255, 247, 0.01) 50%, transparent 100%);
            pointer-events: none;
            z-index: 1;
        }
        
        .main-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 40px;
            position: relative;
            z-index: 2;
        }
        
        .system-header {
            position: absolute;
            top: 20px;
            left: 20px;
            right: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 24px;
            background: rgba(15, 30, 39, 0.8);
            backdrop-filter: blur(20px);
            border: 1px solid var(--border-primary);
            border-radius: 12px;
            box-shadow: var(--glow-cyan);
        }
        
        .system-title {
            font-size: 16px;
            font-weight: 700;
            color: var(--accent-cyan);
            text-transform: uppercase;
            letter-spacing: 2px;
        }
        
        .system-status {
            display: flex;
            align-items: center;
            gap: 16px;
            font-size: 14px;
            font-weight: 500;
        }
        
        .status-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            animation: pulse-status 2s infinite;
        }
        
        .status-dot.connected {
            background: var(--accent-green);
            box-shadow: 0 0 8px var(--accent-green);
        }
        
        .status-dot.disconnected {
            background: var(--accent-red);
            box-shadow: 0 0 8px var(--accent-red);
        }
        
        @keyframes pulse-status {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.7; transform: scale(1.2); }
        }
        
        .username-display {
            color: var(--text-primary);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .timer-display {
            background: rgba(255, 0, 77, 0.1);
            border: 1px solid rgba(255, 0, 77, 0.3);
            padding: 8px 16px;
            border-radius: 8px;
            color: var(--accent-red);
            font-weight: 600;
            font-size: 13px;
            text-transform: uppercase;
            letter-spacing: 1px;
            display: none;
        }
        
        .timer-display.active {
            display: block;
            animation: timer-pulse 1s infinite alternate;
        }
        
        @keyframes timer-pulse {
            from { box-shadow: 0 0 10px rgba(255, 0, 77, 0.3); }
            to { box-shadow: 0 0 20px rgba(255, 0, 77, 0.6); }
        }
        
        @keyframes shuffle-pulse {
            from { 
                box-shadow: 
                    inset 0 0 0 1px rgba(255, 255, 255, 0.1),
                    0 0 0 1px rgba(255, 255, 255, 0.3),
                    0 0 30px rgba(255, 255, 255, 0.2);
            }
            to { 
                box-shadow: 
                    inset 0 0 0 1px rgba(255, 255, 255, 0.2),
                    0 0 0 1px rgba(255, 255, 255, 0.6),
                    0 0 60px rgba(255, 255, 255, 0.4);
            }
        }
        
        .execute-button {
            width: 320px;
            height: 320px;
            border-radius: 50%;
            border: 3px solid var(--button-border-color, var(--accent-cyan));
            background: 
                radial-gradient(circle at 30% 30%, var(--button-bg-glow, rgba(0, 255, 247, 0.4)) 0%, transparent 50%),
                radial-gradient(circle at 70% 70%, var(--button-bg-glow, rgba(0, 255, 247, 0.2)) 0%, transparent 60%),
                linear-gradient(135deg, var(--bg-tertiary) 0%, var(--bg-secondary) 100%);
            color: var(--text-primary);
            font-size: 28px;
            font-weight: 700;
            cursor: pointer;
            position: relative;
            overflow: hidden;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 
                inset 0 0 0 1px rgba(255, 255, 255, 0.1),
                0 0 0 1px var(--button-border-color, var(--accent-cyan)),
                var(--button-glow, var(--glow-cyan));
            text-transform: uppercase;
            letter-spacing: 3px;
        }
        
        .execute-button::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            border-radius: 50%;
            background: var(--button-border-color, var(--accent-cyan));
            z-index: -1;
            opacity: 0.3;
        }
        
        
        .execute-button:hover:not(.executing) {
            transform: scale(1.05);
            box-shadow: 
                inset 0 0 0 1px rgba(255, 255, 255, 0.2),
                0 0 0 1px var(--button-border-color, var(--accent-cyan)),
                var(--button-glow),
                0 0 60px var(--button-glow-color, rgba(0, 255, 247, 0.3));
        }
        
        .execute-button:active {
            transform: scale(0.95);
        }
        
        .execute-button.executing {
            animation: execute-pulse 0.6s ease;
        }
        
        @keyframes execute-pulse {
            0% { transform: scale(1); }
            50% { transform: scale(0.9); }
            100% { transform: scale(1); }
        }
        
        .system-controls {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 16px;
        }
        
        .control-btn {
            width: 56px;
            height: 56px;
            border-radius: 12px;
            border: 1px solid var(--border-primary);
            background: rgba(15, 30, 39, 0.8);
            backdrop-filter: blur(10px);
            color: var(--text-secondary);
            font-size: 24px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }
        
        .control-btn:hover {
            color: var(--accent-cyan);
            border-color: var(--accent-cyan);
            box-shadow: 0 0 20px rgba(0, 255, 247, 0.3);
            transform: translateY(-2px);
        }
        
        .sidebar {
            display: flex;
            flex-direction: column;
            background: rgba(10, 20, 25, 0.95);
            backdrop-filter: blur(30px);
            border-left: 1px solid var(--border-primary);
            min-height: 100vh;
            position: relative;
            z-index: 2;
        }
        
        .sidebar::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 1px;
            height: 100%;
            background: linear-gradient(180deg, transparent, var(--accent-cyan), transparent);
            animation: scan-line 3s linear infinite;
        }
        
        @keyframes scan-line {
            0%, 100% { opacity: 0; }
            50% { opacity: 1; }
        }
        
        .sidebar-section {
            padding: 24px;
            border-bottom: 1px solid var(--border-secondary);
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }
        
        .section-title {
            font-size: 14px;
            font-weight: 700;
            color: var(--accent-cyan);
            text-transform: uppercase;
            letter-spacing: 2px;
        }
        
        .section-count {
            font-size: 12px;
            color: var(--text-muted);
            background: rgba(0, 255, 247, 0.1);
            padding: 4px 8px;
            border-radius: 4px;
            border: 1px solid rgba(0, 255, 247, 0.3);
        }
        
        .remote-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .remote-item {
            padding: 12px;
            background: rgba(15, 30, 39, 0.6);
            border: 1px solid var(--border-secondary);
            border-radius: 8px;
            border-left: 3px solid var(--accent-green);
            transition: all 0.3s ease;
            position: relative;
        }
        
        .remote-item.self {
            border-left-color: var(--accent-cyan);
            background: rgba(0, 255, 247, 0.05);
        }
        
        .remote-item.offline {
            opacity: 0.5;
            border-left-color: var(--text-muted);
        }
        
        .remote-item:hover {
            background: rgba(15, 30, 39, 0.8);
            transform: translateX(4px);
        }
        
        .remote-info {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }
        
        .remote-name {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .remote-id-small {
            font-size: 11px;
            color: var(--text-muted);
            font-family: 'JetBrains Mono', monospace;
        }
        
        .remote-command {
            font-size: 12px;
            color: var(--accent-green);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .remote-status {
            position: absolute;
            top: 8px;
            right: 8px;
            font-size: 10px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .remote-status.online {
            color: var(--accent-green);
        }
        
        .remote-status.offline {
            color: var(--accent-red);
        }
        
        .activity-log {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        .log-header {
            cursor: pointer;
            user-select: none;
        }
        
        .log-entries {
            flex: 1;
            overflow-y: auto;
            padding-right: 8px;
            max-height: 500px;
        }
        
        .log-entries::-webkit-scrollbar {
            width: 4px;
        }
        
        .log-entries::-webkit-scrollbar-track {
            background: rgba(0, 255, 247, 0.1);
        }
        
        .log-entries::-webkit-scrollbar-thumb {
            background: var(--accent-cyan);
            border-radius: 2px;
        }
        
        .log-entry {
            padding: 12px 16px;
            background: rgba(15, 30, 39, 0.8);
            border-radius: 8px;
            margin-bottom: 8px;
            font-size: 13px;
            border-left: 4px solid var(--entry-color, var(--border-primary));
            backdrop-filter: blur(10px);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            transform: translateX(0);
            animation: slideIn 0.3s ease-out;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
            line-height: 1.4;
        }
        
        @keyframes slideIn {
            from {
                transform: translateX(20px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        .log-entry:hover {
            background: rgba(20, 35, 44, 0.9);
            transform: translateX(-2px);
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.4);
        }
        
        .log-entry.user-nacho {
            border-left-color: var(--nacho);
            --entry-color: var(--nacho);
        }
        
        .log-entry.user-cena {
            border-left-color: var(--cena);
            --entry-color: var(--cena);
        }
        
        .log-entry.user-daniel {
            border-left-color: var(--daniel);
            --entry-color: var(--daniel);
        }
        
        .log-entry.user-ace {
            border-left-color: var(--ace);
            --entry-color: var(--ace);
        }
        
        .log-entry.user-maze {
            border-left-color: var(--maze);
            --entry-color: var(--maze);
        }
        
        .log-entry.user-brandon {
            border-left-color: var(--brandon);
            --entry-color: var(--brandon);
        }
        
        .log-entry.user-p {
            border-left-color: var(--p);
            --entry-color: var(--p);
        }
        
        .log-entry:not(.user-nacho):not(.user-cena):not(.user-daniel):not(.user-ace):not(.user-maze):not(.user-brandon):not(.user-p) {
            border-left-color: var(--accent-cyan);
            --entry-color: var(--accent-cyan);
        }
        
        .log-time {
            color: var(--text-muted);
            font-weight: 500;
        }
        
        .log-user {
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .log-action {
            color: var(--text-secondary);
        }
        
        .log-command {
            color: var(--accent-green);
            text-transform: uppercase;
            font-weight: 500;
        }
        
        .settings-tray {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 380px;
            background: rgba(0, 10, 14, 0.98);
            backdrop-filter: blur(30px);
            border-top: 2px solid var(--accent-cyan);
            transform: translateY(100%);
            transition: transform 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            z-index: 1000;
            max-height: 80vh;
            overflow-y: hidden;
            display: flex;
            flex-direction: column;
        }
        
        .settings-tray.open {
            transform: translateY(0);
        }
        
        .settings-header {
            padding: 20px 32px;
            border-bottom: 1px solid var(--border-primary);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(0, 255, 247, 0.05);
        }
        
        .settings-title {
            font-size: 18px;
            font-weight: 700;
            color: var(--accent-cyan);
            text-transform: uppercase;
            letter-spacing: 2px;
        }
        
        .close-btn {
            background: none;
            border: 1px solid var(--accent-red);
            color: var(--accent-red);
            width: 32px;
            height: 32px;
            border-radius: 6px;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .close-btn:hover {
            background: rgba(255, 0, 77, 0.1);
            box-shadow: 0 0 15px rgba(255, 0, 77, 0.3);
        }
        
        .settings-content {
            padding: 32px;
            overflow-y: auto;
            flex: 1;
        }
        
        .settings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 24px;
        }
        
        .settings-panel {
            background: rgba(15, 30, 39, 0.6);
            border: 1px solid var(--border-primary);
            border-radius: 12px;
            padding: 24px;
            backdrop-filter: blur(10px);
        }
        
        .panel-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--accent-green);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .form-group {
            margin-bottom: 16px;
        }
        
        .form-label {
            display: block;
            font-size: 13px;
            font-weight: 500;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 8px;
        }
        
        .form-input {
            width: 100%;
            padding: 12px;
            background: rgba(0, 10, 14, 0.8);
            border: 1px solid var(--border-primary);
            border-radius: 8px;
            color: var(--text-primary);
            font-family: 'JetBrains Mono', monospace;
            font-size: 14px;
            transition: all 0.3s ease;
        }
        
        .form-input:focus {
            outline: none;
            border-color: var(--accent-cyan);
            box-shadow: 0 0 0 2px rgba(0, 255, 247, 0.2);
        }
        
        .tech-btn {
            background: linear-gradient(135deg, rgba(0, 255, 247, 0.1) 0%, rgba(0, 255, 127, 0.1) 100%);
            border: 1px solid var(--accent-cyan);
            color: var(--accent-cyan);
            padding: 12px 20px;
            border-radius: 8px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 13px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .tech-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(0, 255, 247, 0.2), transparent);
            transition: left 0.5s ease;
        }
        
        .tech-btn:hover::before {
            left: 100%;
        }
        
        .tech-btn:hover {
            box-shadow: 0 0 20px rgba(0, 255, 247, 0.4);
            transform: translateY(-2px);
        }
        
        .tech-btn.danger {
            border-color: var(--accent-red);
            color: var(--accent-red);
            background: linear-gradient(135deg, rgba(255, 0, 77, 0.1) 0%, rgba(255, 0, 77, 0.05) 100%);
        }
        
        .tech-btn.success {
            border-color: var(--accent-green);
            color: var(--accent-green);
            background: linear-gradient(135deg, rgba(0, 255, 127, 0.1) 0%, rgba(0, 255, 127, 0.05) 100%);
        }
        
        .pairing-section {
            text-align: center;
            padding: 40px;
            background: rgba(15, 30, 39, 0.6);
            border: 2px solid var(--accent-red);
            border-radius: 16px;
            backdrop-filter: blur(20px);
            box-shadow: 0 0 40px rgba(255, 0, 77, 0.2);
        }
        
        .pairing-title {
            font-size: 22px;
            font-weight: 700;
            color: var(--accent-red);
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-bottom: 16px;
        }
        
        .pairing-input {
            width: 100%;
            max-width: 300px;
            padding: 16px;
            background: rgba(0, 10, 14, 0.8);
            border: 2px solid var(--accent-red);
            border-radius: 12px;
            color: var(--text-primary);
            font-family: 'JetBrains Mono', monospace;
            font-size: 18px;
            text-align: center;
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-bottom: 20px;
        }
        
        .pairing-input:focus {
            outline: none;
            box-shadow: 0 0 30px rgba(255, 0, 77, 0.5);
        }
        
        .hidden {
            display: none !important;
        }
        
        .my-command-display {
            position: absolute;
            top: 120px;
            left: 50%;
            transform: translateX(-50%);
            text-align: center;
            background: rgba(15, 30, 39, 0.9);
            border: 1px solid var(--border-primary);
            border-radius: 12px;
            padding: 12px 20px;
            backdrop-filter: blur(20px);
            box-shadow: var(--glow-cyan);
            z-index: 10;
        }
        
        .command-label {
            font-size: 11px;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 4px;
        }
        
        .command-name {
            font-size: 14px;
            font-weight: 700;
            color: var(--accent-cyan);
            text-transform: uppercase;
            letter-spacing: 2px;
            font-family: 'JetBrains Mono', monospace;
        }
        
        .loading {
            text-align: center;
            color: var(--text-muted);
            font-style: italic;
            padding: 20px;
            font-size: 13px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        /* User-specific colors */
        .user-nacho { color: var(--nacho) !important; }
        .user-cena { color: var(--cena) !important; }
        .user-daniel { color: var(--daniel) !important; }
        .user-ace { color: var(--ace) !important; }
        .user-maze { color: var(--maze) !important; }
        .user-brandon { color: var(--brandon) !important; }
        .user-p, .user-pierogi { color: var(--p) !important; }
        
        .message {
            position: fixed;
            top: 100px;
            left: 50%;
            transform: translateX(-50%);
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            z-index: 9999;
            backdrop-filter: blur(10px);
        }
        
        .message.success {
            background: rgba(0, 255, 127, 0.1);
            border: 1px solid var(--accent-green);
            color: var(--accent-green);
            box-shadow: 0 0 20px rgba(0, 255, 127, 0.3);
        }
        
        .message.error {
            background: rgba(255, 0, 77, 0.1);
            border: 1px solid var(--accent-red);
            color: var(--accent-red);
            box-shadow: 0 0 20px rgba(255, 0, 77, 0.3);
        }
        
        /* Debug Panel Styles */
        .debug-panel {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.95);
            backdrop-filter: blur(30px);
            z-index: 10000;
            display: none;
            flex-direction: column;
            padding: 20px;
            overflow-y: auto;
        }
        
        .debug-panel.open {
            display: flex;
        }
        
        .debug-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid var(--accent-red);
        }
        
        .debug-title {
            font-size: 24px;
            font-weight: 700;
            color: var(--accent-red);
            text-transform: uppercase;
            letter-spacing: 2px;
        }
        
        .debug-subtitle {
            font-size: 12px;
            color: var(--text-muted);
            margin-top: 4px;
        }
        
        .debug-close {
            background: none;
            border: 2px solid var(--accent-red);
            color: var(--accent-red);
            width: 40px;
            height: 40px;
            border-radius: 8px;
            font-size: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .debug-close:hover {
            background: rgba(255, 0, 77, 0.1);
            box-shadow: 0 0 20px rgba(255, 0, 77, 0.3);
        }
        
        .debug-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 16px;
        }
        
        .debug-script-card {
            background: rgba(15, 30, 39, 0.8);
            border: 1px solid var(--border-primary);
            border-radius: 12px;
            padding: 16px;
            transition: all 0.3s ease;
        }
        
        .debug-script-card:hover {
            border-color: var(--accent-cyan);
            box-shadow: 0 0 20px rgba(0, 255, 247, 0.2);
            transform: translateY(-2px);
        }
        
        .debug-script-name {
            font-size: 16px;
            font-weight: 600;
            color: var(--accent-cyan);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 8px;
        }
        
        .debug-script-desc {
            font-size: 12px;
            color: var(--text-secondary);
            margin-bottom: 12px;
            line-height: 1.4;
        }
        
        .debug-script-actions {
            display: flex;
            gap: 8px;
        }
        
        .debug-test-btn {
            flex: 1;
            background: linear-gradient(135deg, rgba(0, 255, 247, 0.1) 0%, rgba(0, 255, 127, 0.1) 100%);
            border: 1px solid var(--accent-green);
            color: var(--accent-green);
            padding: 8px 12px;
            border-radius: 6px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .debug-test-btn:hover {
            box-shadow: 0 0 15px rgba(0, 255, 127, 0.4);
            transform: translateY(-1px);
        }
        
        .debug-test-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
    </style>
</head>
<body>
    <div class="main-container">
        <div class="system-header">
            <div class="system-title">Crew Control</div>
            <div class="system-status">
                <div class="status-item">
                    <div class="status-dot {% if is_paired %}connected{% else %}disconnected{% endif %}"></div>
                    <span class="username-display" id="current-username">ANONYMOUS</span>
                </div>
                <div class="timer-display" id="timer-display">
                    NEXT SHUFFLE: <span id="countdown-timer">--:--</span>
                </div>
            </div>
        </div>

        {% if is_paired %}
            <div id="my-command-display" class="my-command-display">
                <div class="command-label">YOUR ASSIGNED COMMAND:</div>
                <div class="command-name">{{ assigned_command or 'Loading...' }}</div>
            </div>
            
            <button class="execute-button" onclick="executeCommand(event)">
                <span>PRESS</span>
            </button>
            
            <div class="system-controls">
                <button class="control-btn" onclick="toggleSettings()" title="System Configuration">
                    ⚙️
                </button>
            </div>
            
            <div id="command-display" style="display: none;">{{ assigned_command }}</div>
        {% else %}
            <div class="pairing-section">
                <div class="pairing-title">HUB DISCOVERY</div>
                <p style="color: var(--text-secondary); margin-bottom: 24px;">Scanning network for available hubs...</p>
                <div class="loading">🔍 Searching for hubs...</div>
                <div id="connection-status" style="margin-top: 20px; font-size: 12px; color: var(--text-muted);">Initializing NATS connection...</div>
                
                <!-- Manual override if needed -->
                <div id="manual-override" style="display: none; margin-top: 30px; padding-top: 20px; border-top: 1px solid var(--border-secondary);">
                    <p style="color: var(--text-muted); font-size: 12px; margin-bottom: 10px;">Manual connection (if auto-discovery fails):</p>
                    <input type="text" class="pairing-input" id="hub-id" placeholder="HUB-XXXXXXXX" maxlength="12" style="font-size: 14px; padding: 8px;">
                    <br><br>
                    <button class="tech-btn" onclick="manualConnect()" style="font-size: 12px; padding: 8px 16px;">CONNECT TO SPECIFIC HUB</button>
                </div>
                
                <div id="pairing-message" class="message hidden"></div>
            </div>
        {% endif %}
        
        <div id="message" class="message hidden"></div>
    </div>
    
    <div class="sidebar">
        {% if is_paired %}
            <div class="sidebar-section">
                <div class="section-header">
                    <div class="section-title">CONNECTED USERS</div>
                    <div class="section-count" id="remote-count">0 ACTIVE</div>
                </div>
                <div id="remote-list" class="remote-list">
                    <div class="loading">SCANNING NETWORK...</div>
                </div>
            </div>
            
            <div class="sidebar-section activity-log">
                <div class="section-header log-header" onclick="toggleActivityLog()">
                    <div class="section-title">ACTIVITY LOG</div>
                    <div class="section-count" id="log-count">0 EVENTS</div>
                </div>
                <div id="log-entries" class="log-entries">
                    <div class="loading">MONITORING ACTIVITY...</div>
                </div>
            </div>
        {% endif %}
    </div>

    <div id="settings-tray" class="settings-tray">
        <div class="settings-header">
            <div class="settings-title">SYSTEM CONFIGURATION</div>
            <button class="close-btn" onclick="toggleSettings()">×</button>
        </div>
        <div class="settings-content">
            <div class="settings-grid">
                <div class="settings-panel">
                    <div class="panel-title">👤 USER & INTERFACE</div>
                    <div class="form-group">
                        <label class="form-label">DISPLAY NAME</label>
                        <input type="text" id="username-input" class="form-input" placeholder="Enter username" maxlength="20">
                        <button class="tech-btn" onclick="updateUserProfile()" style="margin-top: 8px;">UPDATE PROFILE</button>
                    </div>
                    <div class="form-group">
                        <label class="form-label">
                            <input type="checkbox" id="show-commands" onchange="toggleCommandVisibility()" style="margin-right: 8px;">
                            SHOW COMMAND NAMES FOR ALL USERS
                        </label>
                    </div>
                </div>
                
                <div class="settings-panel">
                    <div class="panel-title">🔀 BUTTON CONTROL</div>
                    <div class="form-group">
                        <button class="tech-btn" onclick="requestShuffle()">MANUAL SHUFFLE</button>
                    </div>
                    <div class="form-group">
                        <label class="form-label">
                            <input type="checkbox" id="timer-enabled" onchange="updateTimerSettings()" style="margin-right: 8px;">
                            AUTO-SHUFFLE TIMER
                        </label>
                        <input type="number" id="timer-minutes" class="form-input" min="1" max="999" value="10" onchange="updateTimerSettings()" style="margin-top: 8px;">
                        <div id="timer-status" class="loading" style="margin-top: 8px;"></div>
                    </div>
                </div>
                
                <div class="settings-panel">
                    <div class="panel-title">📋 SCRIPT MANAGEMENT</div>
                    <div class="form-group" style="display: flex; gap: 8px;">
                        <button class="tech-btn" onclick="loadScriptList()">VIEW SCRIPTS</button>
                        <button class="tech-btn" onclick="updateHubScripts()">UPDATE HUB SCRIPTS</button>
                    </div>
                    <div class="info-text" style="margin-top: 8px; font-size: 12px; color: #888;">
                        Scripts are managed via Git repository. Use update button to pull latest changes.
                    </div>
                    <div id="script-list-container" class="hidden" style="margin-top: 16px;">
                        <div id="script-toggles"></div>
                    </div>
                </div>
                
                {% if is_paired %}
                <div class="settings-panel">
                    <div class="panel-title">🔧 SYSTEM</div>
                    <div class="form-group">
                        <button class="tech-btn danger" onclick="disconnectFromHub()">DISCONNECT FROM HUB</button>
                    </div>
                    <div class="form-group" style="margin-top: 12px;">
                        <button class="tech-btn danger" onclick="shutdownHub()" style="background: linear-gradient(135deg, rgba(255, 0, 0, 0.2) 0%, rgba(255, 0, 0, 0.1) 100%);">
                            🛑 SHUTDOWN HUB
                        </button>
                        <div class="info-text" style="margin-top: 8px; font-size: 11px; color: #ff6666;">
                            WARNING: This will disconnect all remotes
                        </div>
                    </div>
                </div>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Debug Panel (hidden by default) -->
    <div id="debug-panel" class="debug-panel">
        <div class="debug-header">
            <div>
                <div class="debug-title">🔧 SCRIPT DEBUG PANEL</div>
                <div class="debug-subtitle">Press Ctrl+Shift+D to open/close • Test individual scripts without shuffling</div>
            </div>
            <button class="debug-close" onclick="toggleDebugPanel()">×</button>
        </div>
        <div id="debug-grid" class="debug-grid">
            <div class="loading">LOADING SCRIPTS...</div>
        </div>
    </div>

    <script>
        let buttonState = null;
        let timerEnabled = false;
        let timerMinutes = 10;
        let showCommands = true;
        let nextShuffleTime = null;
        let countdownInterval = null;
        let activityLog = [];
        let logCollapsed = false;
        let isShuffling = false;
        let globalShuffling = false;
        
        // User color assignments
        const userColors = {
            'nacho': 'user-nacho',
            'cena': 'user-cena', 
            'daniel': 'user-daniel',
            'ace': 'user-ace',
            'maze': 'user-maze',
            'brandon': 'user-brandon',
            'p': 'user-p',
            'pierogi': 'user-p'
        };
        
        function getUserColorClass(username) {
            const normalizedName = username.toLowerCase().trim();
            return userColors[normalizedName] || '';
        }
        
        // Predefined color palette for scripts
        const colorPalette = [
            { bg: 'linear-gradient(45deg, #8b5cf6, #7c3aed)', shadow: 'rgba(139, 92, 246, 0.4)' }, // Purple
            { bg: 'linear-gradient(45deg, #f59e0b, #d97706)', shadow: 'rgba(245, 158, 11, 0.4)' }, // Amber
            { bg: 'linear-gradient(45deg, #10b981, #059669)', shadow: 'rgba(16, 185, 129, 0.4)' }, // Emerald
            { bg: 'linear-gradient(45deg, #3b82f6, #2563eb)', shadow: 'rgba(59, 130, 246, 0.4)' }, // Blue
            { bg: 'linear-gradient(45deg, #f97316, #ea580c)', shadow: 'rgba(249, 115, 22, 0.4)' }, // Orange
            { bg: 'linear-gradient(45deg, #ec4899, #db2777)', shadow: 'rgba(236, 72, 153, 0.4)' }, // Pink
            { bg: 'linear-gradient(45deg, #06b6d4, #0891b2)', shadow: 'rgba(6, 182, 212, 0.4)' }, // Cyan
            { bg: 'linear-gradient(45deg, #84cc16, #65a30d)', shadow: 'rgba(132, 204, 22, 0.4)' }, // Lime
            { bg: 'linear-gradient(45deg, #ef4444, #dc2626)', shadow: 'rgba(239, 68, 68, 0.4)' }, // Red
            { bg: 'linear-gradient(45deg, #6366f1, #4f46e5)', shadow: 'rgba(99, 102, 241, 0.4)' }, // Indigo
            { bg: 'linear-gradient(45deg, #14b8a6, #0d9488)', shadow: 'rgba(20, 184, 166, 0.4)' }, // Teal
            { bg: 'linear-gradient(45deg, #f472b6, #e879f9)', shadow: 'rgba(244, 114, 182, 0.4)' }, // Fuchsia
            { bg: 'linear-gradient(45deg, #fbbf24, #f59e0b)', shadow: 'rgba(251, 191, 36, 0.4)' }, // Yellow
            { bg: 'linear-gradient(45deg, #a855f7, #9333ea)', shadow: 'rgba(168, 85, 247, 0.4)' }, // Violet
            { bg: 'linear-gradient(45deg, #22c55e, #16a34a)', shadow: 'rgba(34, 197, 94, 0.4)' }, // Green
            { bg: 'linear-gradient(45deg, #e11d48, #be185d)', shadow: 'rgba(225, 29, 72, 0.4)' }, // Rose
            { bg: 'linear-gradient(45deg, #0ea5e9, #0284c7)', shadow: 'rgba(14, 165, 233, 0.4)' }, // Sky
            { bg: 'linear-gradient(45deg, #7c2d12, #92400e)', shadow: 'rgba(124, 45, 18, 0.4)' }, // Brown
            { bg: 'linear-gradient(45deg, #475569, #334155)', shadow: 'rgba(71, 85, 105, 0.4)' }, // Slate
            { bg: 'linear-gradient(45deg, #dc2626, #b91c1c)', shadow: 'rgba(220, 38, 38, 0.4)' }  // Deep Red
        ];
        
        function hashString(str) {
            let hash = 0;
            for (let i = 0; i < str.length; i++) {
                const char = str.charCodeAt(i);
                hash = ((hash << 5) - hash) + char;
                hash = hash & hash;
            }
            return Math.abs(hash);
        }
        
        function getScriptColor(scriptName) {
            if (!scriptName) return colorPalette[9];
            const colorIndex = hashString(scriptName) % colorPalette.length;
            return colorPalette[colorIndex];
        }
        
        function updateButtonColor() {
            const button = document.querySelector('.execute-button');
            if (!button) return;
            
            const commandElement = document.getElementById('command-display');
            if (!commandElement) return;
            
            const command = commandElement.textContent.trim();
            const colors = getScriptColor(command);
            
            const borderColor = colors.shadow.replace('rgba', 'rgb').replace(', 0.4)', ')');
            const glowColor = colors.shadow.replace('0.4', '0.6');
            const bgGlow = colors.shadow.replace('0.4', '0.5'); // More prominent background
            
            button.style.setProperty('--button-border-color', borderColor);
            button.style.setProperty('--button-glow', glowColor);
            button.style.setProperty('--button-glow-color', colors.shadow.replace('0.4', '0.3'));
            button.style.setProperty('--button-bg-glow', bgGlow);
            
            // Force a visual update
            button.style.transform = 'scale(1.001)';
            setTimeout(() => button.style.transform = 'scale(1)', 50);
        }
        
        function showGlobalShuffleState(isShuffling) {
            const button = document.querySelector('.execute-button');
            if (!button) return;
            
            if (isShuffling) {
                // Add shuffling visual state
                button.style.opacity = '0.6';
                button.style.cursor = 'not-allowed';
                button.style.animation = 'shuffle-pulse 1s infinite alternate';
                
                // Show global shuffle message
                showMessage('SHUFFLING', 'info');
            } else {
                // Remove shuffling visual state
                button.style.opacity = '1';
                button.style.cursor = 'pointer';
                button.style.animation = '';
                
                // Update button assignment immediately after shuffle ends
                setTimeout(() => updateButtonAssignment(), 100);
            }
        }
        
        async function updateButtonAssignment() {
            try {
                const response = await fetch('/api/status');
                const result = await response.json();
                
                // Handle global shuffle state
                if (result.shuffle_state === 'start') {
                    globalShuffling = true;
                    showGlobalShuffleState(true);
                } else if (result.shuffle_state === 'end') {
                    globalShuffling = false;
                    showGlobalShuffleState(false);
                }
                
                if (result.assigned_command) {
                    // Update the hidden command display
                    const commandElement = document.getElementById('command-display');
                    if (commandElement) {
                        commandElement.textContent = result.assigned_command;
                        updateButtonColor(); // Update button color based on new assignment
                    }
                    
                    // Update the visible command display
                    const myCommandDisplay = document.getElementById('my-command-display');
                    const commandNameElement = myCommandDisplay?.querySelector('.command-name');
                    if (commandNameElement) {
                        commandNameElement.textContent = result.assigned_command;
                    }
                }
                
                // If assignment was just updated, show message
                if (result.assignment_updated) {
                    const username = localStorage.getItem('username') || 'ANONYMOUS';
                    addActivityLogEntry(username, 'button assignment updated');
                }
            } catch (error) {
                console.error('Error updating button assignment:', error);
            }
        }
        
        function addActivityLogEntry(username, action, command = null) {
            const now = new Date();
            const timeStr = now.toLocaleTimeString('en-US', { 
                hour12: true, 
                hour: 'numeric', 
                minute: '2-digit' 
            });
            
            const entry = {
                time: timeStr,
                username: username,
                action: action,
                command: command
            };
            
            activityLog.unshift(entry);
            if (activityLog.length > 50) {
                activityLog = activityLog.slice(0, 50);
            }
            
            updateActivityLogDisplay();
        }
        
        function updateActivityLogDisplay() {
            const logEntries = document.getElementById('log-entries');
            const logCount = document.getElementById('log-count');
            
            if (!logEntries) return;
            
            logCount.textContent = `${activityLog.length} EVENTS`;
            
            if (activityLog.length === 0) {
                logEntries.innerHTML = '<div class="loading">MONITORING ACTIVITY...</div>';
                return;
            }
            
            logEntries.innerHTML = activityLog.map(entry => {
                const userColorClass = getUserColorClass(entry.username);
                const commandHtml = entry.command && showCommands ? 
                    ` executed <span class="log-command">${entry.command}</span>` : '';
                
                return `
                    <div class="log-entry ${userColorClass}">
                        <span class="log-time">${entry.time}</span> - 
                        <span class="log-user ${userColorClass}">${entry.username}</span> 
                        <span class="log-action">${entry.action}</span>${commandHtml}
                    </div>
                `;
            }).join('');
        }
        
        function toggleActivityLog() {
            const logEntries = document.getElementById('log-entries');
            logCollapsed = !logCollapsed;
            logEntries.style.display = logCollapsed ? 'none' : 'block';
        }
        
        function startCountdownTimer() {
            if (countdownInterval) {
                clearInterval(countdownInterval);
            }
            
            if (!timerEnabled || !nextShuffleTime) {
                document.getElementById('timer-display').classList.remove('active');
                return;
            }
            
            document.getElementById('timer-display').classList.add('active');
            
            countdownInterval = setInterval(() => {
                const now = Date.now();
                const timeLeft = nextShuffleTime - now;
                
                if (timeLeft <= 0) {
                    document.getElementById('countdown-timer').textContent = '00:00';
                    clearInterval(countdownInterval);
                    return;
                }
                
                const minutes = Math.floor(timeLeft / 60000);
                const seconds = Math.floor((timeLeft % 60000) / 1000);
                document.getElementById('countdown-timer').textContent = 
                    `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            }, 1000);
        }
        
        // Initialize on page load
        window.addEventListener('load', async function() {
            const isPaired = {{ 'true' if is_paired else 'false' }};
            
            if (!isPaired) {
                // Auto-connect if not paired
                checkAutoConnection();
            } else {
                // Load existing state for paired remotes
                loadCommandVisibility();
                await getTimerStatus();
                await updateRemoteList();
                loadUsername();
                updateCurrentUsername();
                updateButtonColor();
                
                // Update remote list every 2 minutes (broadcasts handle real-time updates)
                setInterval(updateRemoteList, 120000);
                
                // Update button status every 30 seconds (broadcasts handle most updates)
                setInterval(updateButtonAssignment, 30000);
                
                // Send heartbeat to hub every 60 seconds to maintain connection
                setInterval(sendHeartbeat, 60000);
            }
        });
        
        async function checkAutoConnection() {
            let attempts = 0;
            const maxAttempts = 30; // 1 minute total
            
            // Keep checking connection status
            const checkInterval = setInterval(async () => {
                attempts++;
                
                try {
                    const response = await fetch('/api/status');
                    const result = await response.json();
                    
                    if (result.is_paired) {
                        clearInterval(checkInterval);
                        document.getElementById('connection-status').textContent = 'Connected successfully!';
                        showMessage('CONNECTED TO HUB', 'success', 'pairing-message');
                        setTimeout(() => window.location.reload(), 1500);
                        return;
                    }
                    
                    // Update status based on attempts
                    const statusEl = document.getElementById('connection-status');
                    if (attempts < 5) {
                        statusEl.textContent = 'Initializing NATS connection...';
                    } else if (attempts < 15) {
                        statusEl.textContent = 'Discovering available hubs...';
                    } else if (attempts < 25) {
                        statusEl.textContent = 'Waiting for hub response...';
                    } else {
                        statusEl.textContent = 'Still searching... (check hub is running)';
                    }
                    
                    if (attempts >= maxAttempts) {
                        clearInterval(checkInterval);
                        showMessage('NO HUBS FOUND - Try manual connection', 'error', 'pairing-message');
                        // Show manual override option
                        document.getElementById('manual-override').style.display = 'block';
                        // Restart search after 30 seconds
                        setTimeout(() => {
                            attempts = 0;
                            document.getElementById('manual-override').style.display = 'none';
                            checkAutoConnection();
                        }, 30000);
                    }
                } catch (error) {
                    console.error('Connection check error:', error);
                }
            }, 2000);
        }
        
        async function manualConnect() {
            const hubId = document.getElementById('hub-id').value.trim().toUpperCase();
            if (!hubId || !hubId.startsWith('HUB-') || hubId.length !== 12) {
                showMessage('INVALID HUB ID FORMAT (HUB-XXXXXXXX)', 'error', 'pairing-message');
                return;
            }
            
            showMessage('CONNECTING TO SPECIFIC HUB...', 'info', 'pairing-message');
            
            try {
                // For manual connection, we still need to implement the pairing endpoint
                // or add a manual connect endpoint
                showMessage('MANUAL CONNECTION FEATURE COMING SOON', 'info', 'pairing-message');
            } catch (error) {
                showMessage('NETWORK ERROR', 'error', 'pairing-message');
            }
        }
        
        function loadUsername() {
            const savedUsername = localStorage.getItem('username');
            if (savedUsername) {
                const usernameInput = document.getElementById('username-input');
                if (usernameInput) {
                    usernameInput.value = savedUsername;
                }
            }
        }
        
        function updateCurrentUsername() {
            const savedUsername = localStorage.getItem('username');
            const usernameDisplay = document.getElementById('current-username');
            if (usernameDisplay) {
                const displayName = savedUsername || 'ANONYMOUS';
                usernameDisplay.textContent = displayName;
                usernameDisplay.className = `username-display ${getUserColorClass(displayName)}`;
            }
        }
        
        function updateUserProfile() {
            const username = document.getElementById('username-input').value.trim();
            if (!username) {
                showMessage('PLEASE ENTER A USERNAME', 'error');
                return;
            }
            
            localStorage.setItem('username', username);
            
            fetch('/api/update-username', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ username: username })
            })
            .then(response => response.json())
            .then(result => {
                showMessage('PROFILE UPDATED', 'success');
                updateCurrentUsername();
                updateRemoteList();
            })
            .catch(error => {
                showMessage('UPDATE FAILED', 'error');
            });
        }
        
        function toggleCommandVisibility() {
            showCommands = document.getElementById('show-commands').checked;
            localStorage.setItem('showCommands', showCommands);
            
            // Show/hide the personal command display
            const myCommandDisplay = document.getElementById('my-command-display');
            if (myCommandDisplay) {
                myCommandDisplay.style.display = showCommands ? 'block' : 'none';
            }
            
            updateRemoteList();
            updateActivityLogDisplay();
        }
        
        function loadCommandVisibility() {
            const saved = localStorage.getItem('showCommands');
            showCommands = saved !== null ? saved === 'true' : true;
            const checkbox = document.getElementById('show-commands');
            if (checkbox) {
                checkbox.checked = showCommands;
            }
            
            // Apply the visibility setting to the personal command display
            const myCommandDisplay = document.getElementById('my-command-display');
            if (myCommandDisplay) {
                myCommandDisplay.style.display = showCommands ? 'block' : 'none';
            }
        }
        
        function toggleSettings() {
            const tray = document.getElementById('settings-tray');
            tray.classList.toggle('open');
        }
        
        async function getTimerStatus() {
            try {
                const response = await fetch('/api/timer-status');
                const result = await response.json();
                
                if (result.success) {
                    timerEnabled = result.timer_enabled;
                    timerMinutes = result.timer_minutes || 10;
                    document.getElementById('timer-enabled').checked = timerEnabled;
                    document.getElementById('timer-minutes').value = timerMinutes;
                    updateTimerDisplay();
                    
                    if (timerEnabled) {
                        nextShuffleTime = Date.now() + (timerMinutes * 60000);
                        startCountdownTimer();
                    }
                }
            } catch (error) {
                console.error('Error getting timer status:', error);
            }
        }
        
        function requestShuffle() {
            if (isShuffling) return;
            
            isShuffling = true;
            showMessage('SHUFFLING ASSIGNMENTS...', 'success');
            
            fetch('/api/shuffle', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' }
            })
            .then(response => response.json())
            .then(result => {
                if (result.success) {
                    const username = localStorage.getItem('username') || 'ANONYMOUS';
                    addActivityLogEntry(username, 'triggered manual shuffle');
                    // Don't reload page - let the hub broadcast handle the updates
                    showMessage('SHUFFLE INITIATED', 'success');
                    isShuffling = false;
                } else {
                    showMessage(result.message.toUpperCase(), 'error');
                    isShuffling = false;
                }
            })
            .catch(error => {
                showMessage('SHUFFLE FAILED', 'error');
                isShuffling = false;
            });
        }
        
        function updateTimerSettings() {
            timerEnabled = document.getElementById('timer-enabled').checked;
            timerMinutes = parseInt(document.getElementById('timer-minutes').value) || 10;
            
            fetch('/api/update-timer', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    timer_enabled: timerEnabled,
                    timer_minutes: timerMinutes
                })
            })
            .then(response => response.json())
            .then(result => {
                if (result.success) {
                    updateTimerDisplay();
                    showMessage('TIMER UPDATED', 'success');
                    
                    if (timerEnabled) {
                        nextShuffleTime = Date.now() + (timerMinutes * 60000);
                        startCountdownTimer();
                    } else {
                        document.getElementById('timer-display').classList.remove('active');
                        if (countdownInterval) {
                            clearInterval(countdownInterval);
                        }
                    }
                } else {
                    showMessage('TIMER UPDATE FAILED', 'error');
                }
            })
            .catch(error => {
                showMessage('TIMER UPDATE FAILED', 'error');
            });
        }
        
        function updateTimerDisplay() {
            const statusDiv = document.getElementById('timer-status');
            if (timerEnabled) {
                statusDiv.textContent = `AUTO-SHUFFLE: EVERY ${timerMinutes} MINUTES`;
                statusDiv.style.color = 'var(--accent-green)';
            } else {
                statusDiv.textContent = 'AUTO-SHUFFLE: DISABLED';
                statusDiv.style.color = 'var(--accent-red)';
            }
        }
        
        let lastRemoteStates = new Map(); // Track previous online states
        
        async function updateRemoteList() {
            try {
                const response = await fetch('/api/remote-list');
                const result = await response.json();
                
                if (result.success) {
                    const remoteListDiv = document.getElementById('remote-list');
                    const remoteCountDiv = document.getElementById('remote-count');
                    
                    if (result.remotes && result.remotes.length > 0) {
                        const onlineCount = result.remotes.filter(r => {
                            const timeSinceLastSeen = Date.now() - new Date(r.last_seen).getTime();
                            return timeSinceLastSeen < 60000;
                        }).length;
                        
                        if (remoteCountDiv) {
                            remoteCountDiv.textContent = `${onlineCount} ACTIVE`;
                        }
                        
                        // Check for status changes and log them
                        result.remotes.forEach(remote => {
                            const timeSinceLastSeen = Date.now() - new Date(remote.last_seen).getTime();
                            const isOnline = timeSinceLastSeen < 60000;
                            const displayName = remote.username || 'Anonymous';
                            
                            const lastState = lastRemoteStates.get(remote.remote_id);
                            
                            if (lastState === undefined) {
                                // First time seeing this remote, just track it
                                lastRemoteStates.set(remote.remote_id, isOnline);
                            } else if (lastState !== isOnline) {
                                // Status changed, log it
                                const action = isOnline ? 'came online' : 'went offline';
                                addActivityLogEntry(displayName, action);
                                lastRemoteStates.set(remote.remote_id, isOnline);
                            }
                        });
                        
                        remoteListDiv.innerHTML = result.remotes.map(remote => {
                            const isCurrentRemote = remote.remote_id === result.current_remote_id;
                            const timeSinceLastSeen = Date.now() - new Date(remote.last_seen).getTime();
                            const isOnline = timeSinceLastSeen < 60000;
                            
                            // For current remote, use localStorage username if available
                            let displayName = remote.username;
                            if (isCurrentRemote) {
                                const localUsername = localStorage.getItem('username');
                                displayName = localUsername || remote.username || 'Anonymous';
                            } else {
                                displayName = remote.username || 'Anonymous';
                            }
                            
                            const userColorClass = getUserColorClass(displayName);
                            
                            const commandHtml = showCommands ? 
                                `<div class="remote-command">${remote.assigned_command}</div>` : '';
                            
                            return `
                                <div class="remote-item ${isCurrentRemote ? 'self' : ''} ${!isOnline ? 'offline' : ''}">
                                    <div class="remote-info">
                                        <div class="remote-name ${userColorClass}">
                                            ${isCurrentRemote ? '▶ ' : ''}${displayName.toUpperCase()}
                                        </div>
                                        ${remote.username ? '' : `<div class="remote-id-small">${remote.remote_id}</div>`}
                                        ${commandHtml}
                                    </div>
                                    <div class="remote-status ${isOnline ? 'online' : 'offline'}">
                                        ${isOnline ? 'ONLINE' : 'OFFLINE'}
                                    </div>
                                </div>
                            `;
                        }).join('');
                    } else {
                        if (remoteCountDiv) {
                            remoteCountDiv.textContent = '0 ACTIVE';
                        }
                        remoteListDiv.innerHTML = '<div class="loading">NO NODES DETECTED</div>';
                    }
                }
            } catch (error) {
                console.error('Error updating remote list:', error);
            }
        }
        
        async function executeCommand(event) {
            if (buttonState === 'pressed' || isShuffling || globalShuffling) return;
            
            buttonState = 'pressed';
            const button = event.target;
            button.classList.add('executing');
            
            try {
                const response = await fetch('/api/press', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                });
                
                const result = await response.json();
                showMessage(result.message.toUpperCase(), result.success ? 'success' : 'error');
                
                if (result.success) {
                    const username = localStorage.getItem('username') || 'ANONYMOUS';
                    const commandElement = document.getElementById('command-display');
                    const command = commandElement ? commandElement.textContent.trim() : null;
                    addActivityLogEntry(username, 'executed command', command);
                }
                
            } catch (error) {
                showMessage('EXECUTION FAILED', 'error');
            }
            
            setTimeout(() => {
                buttonState = null;
                button.classList.remove('executing');
            }, 600);
        }
        
        function sendHeartbeat() {
            // Send heartbeat to maintain connection status
            fetch('/api/heartbeat', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' }
            }).catch(error => {
                console.log('Heartbeat failed:', error);
            });
        }
        
        // Script management functions
        async function loadScriptList() {
            const container = document.getElementById('script-list-container');
            const togglesDiv = document.getElementById('script-toggles');
            
            if (!container.classList.contains('hidden')) {
                container.classList.add('hidden');
                return;
            }
            
            container.classList.remove('hidden');
            togglesDiv.innerHTML = '<div class="loading">LOADING SCRIPTS...</div>';
            
            try {
                const response = await fetch('/api/script-list');
                const result = await response.json();
                
                if (result.success && result.scripts) {
                    if (result.scripts.length === 0) {
                        togglesDiv.innerHTML = '<div class="loading">NO SCRIPTS AVAILABLE</div>';
                        return;
                    }
                    
                    togglesDiv.innerHTML = result.scripts.map(script => {
                        const statusClass = script.enabled ? 'success' : 'danger';
                        const statusText = script.enabled ? 'ENABLED' : 'DISABLED';
                        const displayName = script.display_name || script.name;
                        const description = script.description || 'No description available';
                        
                        return `
                            <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px; background: rgba(15, 30, 39, 0.6); border-radius: 8px; margin-bottom: 8px;">
                                <div>
                                    <div style="color: var(--text-primary); font-weight: 600; font-size: 14px; text-transform: uppercase;">${displayName}</div>
                                    <div style="color: var(--text-secondary); font-size: 12px; margin-bottom: 4px;">${description}</div>
                                    <div style="color: var(--accent-${script.enabled ? 'green' : 'red'}); font-size: 12px; font-weight: 500;">${statusText}</div>
                                </div>
                                <button class="tech-btn ${statusClass}" onclick="toggleScript('${script.name}', ${!script.enabled})" style="padding: 8px 16px;">
                                    ${script.enabled ? 'DISABLE' : 'ENABLE'}
                                </button>
                            </div>
                        `;
                    }).join('');
                } else {
                    togglesDiv.innerHTML = '<div class="loading">FAILED TO LOAD SCRIPTS</div>';
                    showMessage(result.message || 'SCRIPT LOAD FAILED', 'error');
                }
                
            } catch (error) {
                togglesDiv.innerHTML = '<div class="loading">ERROR LOADING SCRIPTS</div>';
                showMessage('SCRIPT LOAD ERROR', 'error');
            }
        }
        
        async function toggleScript(scriptName, enable) {
            try {
                const response = await fetch('/api/toggle-script', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        script_name: scriptName,
                        enabled: enable
                    })
                });
                
                const result = await response.json();
                if (result.success) {
                    showMessage(result.message.toUpperCase(), 'success');
                    setTimeout(() => {
                        loadScriptList();
                        loadScriptList(); // Toggle twice to refresh
                    }, 500);
                } else {
                    showMessage(result.message.toUpperCase(), 'error');
                }
                
            } catch (error) {
                showMessage('TOGGLE FAILED', 'error');
            }
        }
        
        async function updateHubScripts() {
            try {
                showMessage('UPDATING SCRIPTS FROM GIT...', 'info');
                
                const response = await fetch('/api/update-scripts', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showMessage('HUB SCRIPTS UPDATED SUCCESSFULLY', 'success');
                    // Refresh script list if it's currently visible
                    const container = document.getElementById('script-list-container');
                    if (!container.classList.contains('hidden')) {
                        setTimeout(() => {
                            loadScriptList();
                            loadScriptList(); // Toggle twice to refresh
                        }, 1000);
                    }
                } else {
                    showMessage(result.message.toUpperCase() || 'SCRIPT UPDATE FAILED', 'error');
                }
                
            } catch (error) {
                showMessage('SCRIPT UPDATE ERROR', 'error');
                console.error('Script update error:', error);
            }
        }
        
        async function initiateConnection() {
            const pairingCode = document.getElementById('pairing-code').value;
            
            if (!pairingCode) {
                showMessage('AUTHORIZATION CODE REQUIRED', 'error', 'pairing-message');
                return;
            }
            
            try {
                showMessage('ESTABLISHING CONNECTION...', 'success', 'pairing-message');
                
                const response = await fetch('/api/pair', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ pairing_code: pairingCode })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showMessage('CONNECTION ESTABLISHED', 'success', 'pairing-message');
                    
                    let attempts = 0;
                    const maxAttempts = 15;
                    
                    const checkConnection = async () => {
                        try {
                            const statusResponse = await fetch('/api/status');
                            const statusResult = await statusResponse.json();
                            
                            if (statusResult.is_paired) {
                                showMessage('AUTHENTICATION SUCCESSFUL', 'success', 'pairing-message');
                                setTimeout(() => window.location.reload(), 1500);
                                return;
                            }
                            
                            attempts++;
                            if (attempts < maxAttempts) {
                                setTimeout(checkConnection, 2000);
                            } else {
                                showMessage('CONNECTION TIMEOUT', 'error', 'pairing-message');
                            }
                        } catch (error) {
                            showMessage('CONNECTION ERROR', 'error', 'pairing-message');
                        }
                    };
                    
                    setTimeout(checkConnection, 2000);
                    
                } else {
                    showMessage(result.message.toUpperCase(), 'error', 'pairing-message');
                }
                
            } catch (error) {
                showMessage('CONNECTION FAILED', 'error', 'pairing-message');
            }
        }
        
        async function disconnectFromHub() {
            if (!confirm('DISCONNECT FROM HUB?')) return;
            
            try {
                const response = await fetch('/api/reset', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                });
                
                const result = await response.json();
                showMessage(result.message.toUpperCase(), result.success ? 'success' : 'error');
                
                if (result.success) {
                    // Only reload on disconnect since we need to show pairing screen
                    setTimeout(() => window.location.reload(), 1500);
                }
                
            } catch (error) {
                showMessage('DISCONNECT FAILED', 'error');
            }
        }
        
        async function shutdownHub() {
            if (!confirm('⚠️ SHUTDOWN HUB?\n\nThis will disconnect ALL remotes and stop the hub completely.')) return;
            
            try {
                const response = await fetch('/api/shutdown-hub', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showMessage('HUB SHUTDOWN INITIATED', 'success');
                    // Wait a bit then show disconnected state
                    setTimeout(() => {
                        showMessage('HUB CONNECTION LOST', 'error');
                        // Reload to show pairing screen
                        setTimeout(() => window.location.reload(), 2000);
                    }, 3000);
                } else {
                    showMessage(result.message || 'SHUTDOWN FAILED', 'error');
                }
                
            } catch (error) {
                showMessage('SHUTDOWN COMMAND FAILED', 'error');
            }
        }
        
        function showMessage(text, type, elementId = 'message') {
            const element = document.getElementById(elementId);
            element.textContent = text;
            element.className = `message ${type}`;
            element.classList.remove('hidden');
            
            setTimeout(() => {
                element.classList.add('hidden');
            }, 3000);
        }
        
        document.addEventListener('keypress', function(e) {
            if (e.key === 'Enter' && document.getElementById('pairing-code')) {
                initiateConnection();
            }
        });
        
        // Debug panel hotkey - Ctrl+Shift+D
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey && e.shiftKey && e.key === 'D') {
                e.preventDefault();
                toggleDebugPanel();
            }
        });
        
        // Debug Panel Functions
        let debugPanelOpen = false;
        let debugScripts = [];
        
        function toggleDebugPanel() {
            const panel = document.getElementById('debug-panel');
            debugPanelOpen = !debugPanelOpen;
            
            if (debugPanelOpen) {
                panel.classList.add('open');
                loadDebugScripts();
            } else {
                panel.classList.remove('open');
            }
        }
        
        async function loadDebugScripts() {
            const grid = document.getElementById('debug-grid');
            grid.innerHTML = '<div class="loading">LOADING SCRIPTS...</div>';
            
            try {
                const response = await fetch('/api/script-list');
                const result = await response.json();
                
                if (result.success && result.scripts) {
                    debugScripts = result.scripts;
                    renderDebugScripts();
                } else {
                    grid.innerHTML = '<div class="loading">FAILED TO LOAD SCRIPTS</div>';
                }
            } catch (error) {
                grid.innerHTML = '<div class="loading">ERROR LOADING SCRIPTS</div>';
            }
        }
        
        function renderDebugScripts() {
            const grid = document.getElementById('debug-grid');
            
            if (debugScripts.length === 0) {
                grid.innerHTML = '<div class="loading">NO SCRIPTS AVAILABLE</div>';
                return;
            }
            
            grid.innerHTML = debugScripts.map(script => {
                const statusBadge = script.enabled ? 
                    '<span style="color: var(--accent-green); font-size: 10px;">● ENABLED</span>' :
                    '<span style="color: var(--accent-red); font-size: 10px;">● DISABLED</span>';
                
                return `
                    <div class="debug-script-card">
                        <div class="debug-script-name">
                            ${script.name} ${statusBadge}
                        </div>
                        <div class="debug-script-actions">
                            <button class="debug-test-btn" 
                                    onclick="testScript('${script.name}')"
                                    ${!script.enabled ? 'disabled' : ''}>
                                ▶️ TRIGGER NOW
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        async function testScript(scriptName) {
            try {
                showMessage(`TRIGGERING: ${scriptName.toUpperCase()}`, 'info');
                
                // Send debug execution request directly to hub
                const response = await fetch('/api/debug-execute', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ script_name: scriptName })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showMessage(`${scriptName.toUpperCase()}: EXECUTED`, 'success');
                    const username = localStorage.getItem('username') || 'ANONYMOUS';
                    addActivityLogEntry(username, `debug executed: ${scriptName}`);
                } else {
                    showMessage(`${scriptName.toUpperCase()}: ${result.message}`, 'error');
                }
                
            } catch (error) {
                showMessage(`${scriptName.toUpperCase()}: TEST FAILED`, 'error');
            }
        }
    </script>
</body>
</html>